# 每日自動開 Digest Issue（UTC 時間；台灣 +8 要自行換算）
name: daily-intel-issue

on:
  schedule:
    - cron: "0 1 * * *"  # 01:00 UTC = 09:00 Asia/Taipei
  workflow_dispatch:

permissions:
  issues: write

jobs:
  open-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create daily digest issue
        uses: actions/github-script@v7
        with:
          script: |
            const today = new Date().toISOString().slice(0,10);
            const title = `[Digest] ${today}`;
            const body = [
              "自動建立的每日 Digest 任務單。",
              "",
              "**DoD：**",
              "- [ ] 產出 `out/digest-" + today + ".md`",
              "- [ ] 每個來源至少 Top 5（標題 + 連結）",
              "- [ ] Markdown 格式正確",
              "",
              "來源請參考 `ops/feeds.yml`"
            ].join("\n");
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ["intel", "digest"]
            });
